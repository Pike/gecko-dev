<?xml version="1.0"?>

<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<bindings id="localizationBindings"
          xmlns="http://www.mozilla.org/xbl">

  <binding id="xul">
    <implementation implements="nsIDOMEventListener">
      <constructor>
        <![CDATA[
          const { utils: Cu } = Components;
          Cu.import("resource://gre/modules/Console.jsm");

          Cu.import('resource://gre/modules/L10nService.jsm');
          Cu.import('resource://gre/modules/XULLocalization.jsm');

          const resIds = Array.from(this.children).map(
            child => child.getAttribute('src')
          );

          console.log(resIds);

          function requestBundles(requestedLangs = new Set(navigator.languages)) {
            return Promise.resolve().then(() => {
              const {
                resBundles
              } = L10nService.getResources(requestedLangs, resIds);

              return resBundles;
            });
          }

          this.l10n = createXULLocalization(requestBundles);

          document.l10n.observeRoot(this, this.l10n);
          document.l10n.translateRoot(this);

        ]]>
      </constructor>

      <destructor>
        <![CDATA[
          document.l10n.disconnectRoot(this);
        ]]>
      </destructor>

      <field name="l10n">null</field>

      <method name="formatEntities">
        <parameter name="keys"/>
        <body>
          <![CDATA[
            console.log(this, keys);
            return [{
              value: null,
              attrs: {
                label: "Nowa karta",
                placeholder: "WprowadÅº adres lub szukaj"
              }
            }];
          ]]>
        </body>
      </method>

    </implementation>
  </binding>

</bindings>
